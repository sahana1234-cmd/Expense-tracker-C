<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Expense Tracker (Frontend + Backend)</title>
  <style>
    :root{
      --bg: linear-gradient(135deg, #ff7eb3, #6a77ff);
      --text: #ffffff;
      --card: rgba(255,255,255,0.20);
      --muted: rgba(255,255,255,0.85);
      --shadow: rgba(0,0,0,0.25);
    }
    .dark{
      --bg: #0b0c10;
      --text: #f2f2f2;
      --card: rgba(255,255,255,0.06);
      --muted: rgba(255,255,255,0.86);
      --shadow: rgba(0,0,0,0.5);
    }

    body{
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background 250ms ease;
    }

    nav{
      position: sticky;
      top: 0;
      z-index: 5;
      background: rgba(255,255,255,0.14);
      backdrop-filter: blur(10px);
      display: flex;
      gap: 10px;
      padding: 12px 14px;
      align-items: center;
      flex-wrap: wrap;
    }
    nav a{
      color: var(--text);
      font-weight: 700;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 9px;
      cursor: pointer;
      user-select: none;
      transition: background 200ms ease;
    }
    nav a:hover{ background: rgba(255,255,255,0.28); }

    #darkToggle{
      margin-left: auto;
      border: none;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 800;
      cursor: pointer;
      background: #ffffff;
      color: #1e1e1e;
    }

    .container{ padding: 18px; }

    .section{ display: none; }
    .active{ display: block; }

    .hero{ text-align: center; margin: 10px auto 18px; }
    .hero h1{ margin: 8px 0; letter-spacing: 0.2px; }
    .hero p{ margin: 0; opacity: 0.95; }

    .grid{
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(12, 1fr);
      align-items: start;
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 14px;
      box-shadow: 0 10px 22px var(--shadow);
      padding: 16px;
      backdrop-filter: blur(8px);
    }

    .col-12{ grid-column: span 12; }
    .col-6{ grid-column: span 6; }
    .col-4{ grid-column: span 4; }

    label{ display: block; font-weight: 800; margin: 8px 0 2px; }
    input, select{
      width: 100%;
      box-sizing: border-box;
      padding: 10px 10px;
      border-radius: 10px;
      border: none;
      outline: none;
      margin-bottom: 6px;
    }

    .btn{
      width: 100%;
      border: none;
      border-radius: 10px;
      padding: 10px 12px;
      font-weight: 900;
      cursor: pointer;
      background: #ffffff;
      color: #1c1c1c;
      margin-top: 6px;
    }
    .btn:active{ transform: scale(0.98); }

    .mini{
      font-size: 13px;
      opacity: 0.9;
      line-height: 1.35;
    }

    ul{ margin: 0; padding-left: 18px; }
    li{ margin: 4px 0; }

    .badge{
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      margin-left: 6px;
    }
    .ok{ background:#1dd1a1; color:#062015; }
    .warn{ background:#ffeaa7; color:#2a1e00; }
    .bad{ background:#ff6b6b; color:#2a0000; }

    #meter{ width: 100%; height: 16px; border-radius: 999px; background: rgba(255,255,255,0.22); overflow: hidden; margin-top: 8px; }
    #meterFill{ height: 100%; width: 0%; background: #1dd1a1; transition: width 400ms ease, background 400ms ease; }

    pre{ background: #ffffff; color:#111; border-radius: 12px; padding: 10px; overflow-x:auto; }

    @media (max-width: 760px){
      .col-6, .col-4 { grid-column: span 12; }
      #darkToggle{ margin-left: 0; width: 100%; }
    }
  </style>
</head>

<body>
  <nav id="navbar" style="display:none;">
    <a onclick="show('home')">Home</a>
    <a onclick="show('add')">Add Expense</a>
    <a onclick="show('tracker')">Tracker</a>
    <a onclick="show('charts')">Charts</a>
    <a onclick="show('advisor')">Advisor</a>
    <a onclick="show('backend')">Backend</a>
    <button id="darkToggle" onclick="toggleDark()">Dark Mode</button>
  </nav>

  <div class="container">

    <!-- LOGIN -->
    <div id="login" class="section active">
      <div class="grid">
        <div class="col-12">
          <div class="card" style="max-width:420px; margin: 0 auto;">
            <div class="hero">
              <h1>Smart Expense Tracker</h1>
              <p class="mini">Login to unlock dashboards (demo credentials embedded).</p>
            </div>

            <label>Username</label>
            <input id="user" type="text" placeholder="e.g., sahana" autocomplete="username">

            <label>Password</label>
            <input id="pass" type="password" placeholder="e.g., pooja" autocomplete="current-password">

            <button class="btn" onclick="login()">Login</button>
            <p id="loginMsg" class="mini"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- HOME -->
    <div id="home" class="section">
      <div class="hero">
        <h1>Welcome to Your Smart Expense Dashboard</h1>
        <p class="mini">Add expenses, analyze patterns, export CSV, and track savings — all in one place.</p>
      </div>
      <div class="grid">
        <div class="col-6">
          <div class="card">
            <h3>What you get (Frontend)</h3>
            <ul class="mini">
              <li>Login + navigation</li>
              <li>Expense entry with month & category</li>
              <li>Bar chart (monthly totals) + pie chart (category split)</li>
              <li>Budget alerts + savings meter</li>
              <li>CSV export + local storage persistence</li>
            </ul>
          </div>
        </div>
        <div class="col-6">
          <div class="card">
            <h3>Project Architecture</h3>
            <p class="mini">
              Frontend (this website) is the user interface. A separate <b>C backend</b> (in <code>/backend</code>)
              implements <b>structures</b>, <b>dynamic memory</b>, and <b>file-based storage</b> to satisfy the project topic.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ADD EXPENSE -->
    <div id="add" class="section">
      <div class="grid">
        <div class="col-6">
          <div class="card">
            <h2>Add Expense</h2>
            <p class="mini">Tip: Add one entry per spending event (e.g., “Food – 320”). Salary & fixed are used to compute savings + alerts.</p>

            <label>Salary (monthly)</label>
            <input id="salary" type="number" min="0" step="1" placeholder="e.g., 30000">

            <label>Fixed Expenditure (rent, subscription etc.)</label>
            <input id="fixed" type="number" min="0" step="1" placeholder="e.g., 8000">

            <label>Month</label>
            <select id="month">
              <option>January</option><option>February</option><option>March</option>
              <option>April</option><option>May</option><option>June</option>
              <option>July</option><option>August</option><option>September</option>
              <option>October</option><option>November</option><option>December</option>
            </select>

            <label>Category</label>
            <select id="category" onchange="handleCategory()">
              <option>Food</option>
              <option>Travel</option>
              <option>Shopping</option>
              <option>Bills</option>
              <option>Other</option>
            </select>

            <label>Custom Category (if Other)</label>
            <input id="customCategory" type="text" placeholder="e.g., Education / Health" disabled>

            <label>Amount</label>
            <input id="amount" type="number" min="0" step="0.01" placeholder="e.g., 450.75">

            <button class="btn" onclick="addExpense()">Save Expense</button>
            <button class="btn" onclick="exportCSV()">Export CSV</button>
            <p id="addMsg" class="mini"></p>
          </div>
        </div>

        <div class="col-6">
          <div class="card">
            <h2>Monthly Savings Meter</h2>
            <p class="mini">Savings = Salary − Fixed − Total variable spending (for selected month).</p>
            <div id="meter"><div id="meterFill"></div></div>
            <p class="mini" id="meterText" style="margin-top:8px;"></p>

            <h3 style="margin-top:14px;">Budget Alert</h3>
            <p class="mini" id="alertText">Add expenses to see alerts.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- TRACKER -->
    <div id="tracker" class="section">
      <div class="grid">
        <div class="col-12">
          <div class="card">
            <h2>Expense Tracker (All Entries)</h2>
            <p class="mini">Entries are saved in your browser (Local Storage) so they remain after refresh.</p>
            <ul id="list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- CHARTS (BAR + PIE) -->
    <div id="charts" class="section">
      <div class="grid">
        <div class="col-6">
          <div class="card">
            <h2>Monthly Total (Bar)</h2>
            <canvas id="barChart" height="220"></canvas>
          </div>
        </div>
        <div class="col-6">
          <div class="card">
            <h2>Category Split (Pie)</h2>
            <canvas id="pieChart" height="220"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- ADVISOR (PREDICTION) -->
    <div id="advisor" class="section">
      <div class="grid">
        <div class="col-12">
          <div class="card">
            <h2>Smart Advisor (Prediction + Guidance)</h2>
            <p class="mini">Prediction uses your last months’ totals (simple weighted average) to estimate next month spending.</p>
            <p id="adviceText" class="mini"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- BACKEND (C PROGRAM) -->
    <div id="backend" class="section">
      <div class="grid">
        <div class="col-12">
          <div class="card">
            <h2>C Backend (Structures + Dynamic Memory + File Storage)</h2>
            <p class="mini">
              This project is split into <b>Frontend (website)</b> and <b>Backend (C program)</b>.
              The backend is a console application that stores expenses in <code>expenses.txt</code> using
              <b>struct</b> records + <b>malloc/realloc</b> for dynamic growth and supports SAVE/LOAD operations.
            </p>

            <button class="btn" onclick="window.location.href='../backend/expense_tracker.c'">Download C Backend</button>

            <h3 style="margin-top:12px;">Backend Output (sample)</h3>
            <pre>[Backend] Load -> 8 records
[Backend] Save -> expenses.txt updated
[Backend] Records stored using struct + realloc</pre>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ---------------------------
    // Storage helpers (Local Storage)
    // ---------------------------
    const LS_KEY = "expense_app_data_v1";
    const LS_THEME = "expense_app_theme_v1";

    function loadState(){
      try{
        return JSON.parse(localStorage.getItem(LS_KEY)) || { expenses: [] };
      }catch(e){ return { expenses: [] }; }
    }
    function saveState(state){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    // ---------------------------
    // Global state
    // ---------------------------
    let state = loadState();
    let barInstance = null;
    let pieInstance = null;

    // ---------------------------
    // Navigation + theme
    // ---------------------------
    function show(page){
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById(page).classList.add("active");

      if(page === "tracker") renderList();
      if(page === "charts") { renderCharts(); }
      if(page === "advisor") renderAdvisor();
    }

    function applyTheme(){
      const isDark = localStorage.getItem(LS_THEME) === "dark";
      document.body.classList.toggle("dark", isDark);
      document.getElementById("darkToggle").innerText = isDark ? "Light Mode" : "Dark Mode";
    }

    function toggleDark(){
      const isDark = document.body.classList.contains("dark");
      localStorage.setItem(LS_THEME, isDark ? "light" : "dark");
      applyTheme();
    }

    // ---------------------------
    // Login (fixed demo credentials)
    // ---------------------------
    function login(){
      const u = document.getElementById("user").value.trim();
      const p = document.getElementById("pass").value.trim();

      // Demo credentials (you can change them)
      if(u === "sahana" && p === "pooja"){
        document.getElementById("login").style.display = "none";
        document.getElementById("navbar").style.display = "flex";
        show("home");
      } else {
        document.getElementById("loginMsg").innerText = "Wrong username or password (try: sahana / pooja).";
      }
    }

    // ---------------------------
    // Add expense + core computations
    // ---------------------------
    function handleCategory(){
      const cat = document.getElementById("category").value;
      document.getElementById("customCategory").disabled = (cat !== "Other");
      if(cat !== "Other") document.getElementById("customCategory").value = "";
    }

    function addExpense(){
      const salary = Number(document.getElementById("salary").value || 0);
      const fixed = Number(document.getElementById("fixed").value || 0);
      const month = document.getElementById("month").value;
      let category = document.getElementById("category").value;
      const custom = document.getElementById("customCategory").value.trim();
      if(category === "Other" && custom !== "") category = custom;

      const amount = Number(document.getElementById("amount").value || 0);

      if(!month || amount <= 0){
        document.getElementById("addMsg").innerText = "Please enter a valid month and amount (> 0).";
        return;
      }

      state.expenses.push({ month, category, amount, salary, fixed, ts: Date.now() });
      saveState(state);

      document.getElementById("addMsg").innerText = "Saved! (Data is stored locally in your browser.)";
      renderList();
      updateSavingsAndAlerts(month, salary, fixed);
      // keep charts/advisor consistent if user navigates
    }

    function monthlyTotals(){
      const totals = {};
      for(const e of state.expenses){
        totals[e.month] = (totals[e.month] || 0) + (e.amount || 0);
      }
      return totals;
    }

    function categoryTotals(){
      const totals = {};
      for(const e of state.expenses){
        totals[e.category] = (totals[e.category] || 0) + (e.amount || 0);
      }
      return totals;
    }

    function renderList(){
      const ul = document.getElementById("list");
      ul.innerHTML = "";
      if(state.expenses.length === 0){
        ul.innerHTML = "<li class='mini'>No expenses yet. Add one from <b>Add Expense</b> page.</li>";
        return;
      }
      state.expenses.forEach((e, idx) => {
        const li = document.createElement("li");
        li.className = "mini";
        li.textContent = `${e.month} • ${e.category} → ₹${e.amount.toFixed(2)}`;
        ul.appendChild(li);

        // also update savings/alert using the most recent entry (good default)
        if(idx === state.expenses.length - 1){
          updateSavingsAndAlerts(e.month, e.salary, e.fixed);
        }
      });
    }

    // ---------------------------
    // Savings meter + alerts
    // ---------------------------
    function updateSavingsAndAlerts(month, salary, fixed){
      // Determine budget base from last provided values (simple and exam-friendly)
      const budget = Math.max(0, (Number(salary) || 0) - (Number(fixed) || 0));
      const spent = (monthlyTotals()[month] || 0);

      // Avoid NaN issues
      const safeBudget = isFinite(budget) ? budget : 0;
      const safeSpent  = isFinite(spent)  ? spent  : 0;

      const savings = Math.max(0, safeBudget - safeSpent);
      const percentUsed = safeBudget <= 0 ? 0 : Math.min(100, (safeSpent / safeBudget) * 100);

      // meter fill
      const fill = document.getElementById("meterFill");
      const text = document.getElementById("meterText");
      const alert = document.getElementById("alertText");
      if(!fill || !text || !alert) return;

      fill.style.width = `${percentUsed}%`;
      if(percentUsed < 40){
        fill.style.background = "#1dd1a1";
        alert.innerHTML = `Status: <span class="badge ok">Healthy</span> — spending under 40% of budget.`;
      } else if(percentUsed < 70){
        fill.style.background = "#ffeaa7";
        alert.innerHTML = `Status: <span class="badge warn">Watch</span> — spending crossed 40% of budget.`;
      } else {
        fill.style.background = "#ff6b6b";
        alert.innerHTML = `Status: <span class="badge bad">Danger</span> — spending crossed 70% of budget.`;
      }

      text.innerText = `Budget (Salary - Fixed): ₹${safeBudget.toFixed(2)} | Spent: ₹${safeSpent.toFixed(2)} | Savings: ₹${savings.toFixed(2)}`;
    }

    // ---------------------------
    // Charts (bar + pie)
    // ---------------------------
    function renderCharts(){
      const barCtx = document.getElementById("barChart").getContext("2d");
      const pieCtx = document.getElementById("pieChart").getContext("2d");

      const mTotals = monthlyTotals();
      const cTotals = categoryTotals();

      if(barInstance) barInstance.destroy();
      if(pieInstance) pieInstance.destroy();

      barInstance = new Chart(barCtx, {
        type: "bar",
        data: {
          labels: Object.keys(mTotals),
          datasets: [{ label: "Monthly Expense (₹)", data: Object.values(mTotals), backgroundColor: "rgba(255,255,255,0.75)" }]
        },
        options: { responsive: true, plugins: { legend: { labels: { color: "#ffffff" } } },
          scales: { x: { ticks: { color: "#ffffff" } }, y: { ticks: { color: "#ffffff" } } } }
      });

      pieInstance = new Chart(pieCtx, {
        type: "pie",
        data: {
          labels: Object.keys(cTotals),
          datasets: [{ label: "Category Split", data: Object.values(cTotals), backgroundColor: [
            "#ffffff", "#c6a7ff", "#ffb6c1", "#a6ffce", "#ffe08a", "#b8c6ff"
          ] }]
        },
        options: { responsive: true, plugins: { legend: { labels: { color: "#ffffff" } } } }
      });
    }

    // ---------------------------
    // Advisor (simple prediction)
    // ---------------------------
    function renderAdvisor(){
      const totals = monthlyTotals();
      const months = Object.keys(totals);

      if(months.length === 0){
        document.getElementById("adviceText").innerText = "Add at least one expense to enable prediction.";
        return;
      }

      // Build an ordered list by last-used timestamp (approximate chronological order)
      const sorted = [...state.expenses].sort((a,b) => a.ts - b.ts);
      const lastMonths = [];
      for(const e of sorted){
        if(!lastMonths.includes(e.month)) lastMonths.push(e.month);
      }
      const last = lastMonths.slice(-3); // last up to 3 months

      let sum = 0, wSum = 0;
      // weight recent months slightly higher
      for(let i=0;i<last.length;i++){
        const w = (i === last.length-1) ? 0.5 : (i === last.length-2 ? 0.3 : 0.2);
        sum += (totals[last[i]] || 0) * w;
        wSum += w;
      }
      const predicted = wSum > 0 ? sum / wSum : (totals[last[0]] || 0);

      const bestMonth = months.reduce((a,b) => (totals[a] > totals[b] ? a : b));
      const msg = `Prediction (next month): ₹${predicted.toFixed(2)} (based on last ${last.length} month(s)). ` +
                  `Highest month so far: ${bestMonth} (₹${totals[bestMonth].toFixed(2)}). ` +
                  `Tip: keep the next month under your budget to stay in the “Healthy” zone.`;

      document.getElementById("adviceText").innerText = msg;
    }

    // ---------------------------
    // CSV export
    // ---------------------------
    function exportCSV(){
      if(state.expenses.length === 0){
        alert("No data to export. Add at least one expense first.");
        return;
      }
      const header = "Month,Category,Amount,Salary,Fixed\n";
      const rows = state.expenses.map(e =>
        `${e.month},${(e.category || "").replace(/,/g," ")},${e.amount},${e.salary},${e.fixed}`
      );
      const csv = header + rows.join("\n");

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "expenses_export.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ---------------------------
    // Init on load
    // ---------------------------
    window.addEventListener("load", () => {
      applyTheme();
      // If there is existing data, show it when user logs in (helps tester)
      if(state.expenses.length > 0){
        // nothing special; data will show once user logs in and navigates
      }
    });
  </script>
</body>
</html>
